model Order {
  id              Int       @id @default(autoincrement())
  orderNumber     String?   @map("order_number")
  totalAmount     Float?    @default(0) @map("total_amount")
  totalTax        Float?    @default(0) @map("total_tax")
  totalDiscount   Float?    @default(0) @map("total_discounts")
  shippingCharges Float?    @default(0) @map("shipping_charges")
  tags            String[]  @map("tags")
  status          String    @default("Received") @map("status")
  remarks         String?   @map("remarks")
  createdAt       DateTime? @default(now()) @map("created_at")
  deletedAt       DateTime? @map("deleted_at")

  customerId Int?      @map("customer_id")
  customer   Customer? @relation(fields: [customerId], references: [id])

  channelId Int?     @map("channel_id")
  channel   Channel? @relation(fields: [channelId], references: [id])

  brandId Int?   @map("brand_id")
  brand   Brand? @relation(fields: [brandId], references: [id])

  courierServiceId Int?            @map("courier_service_id")
  courerService    CourierService? @relation(fields: [courierServiceId], references: [id])

  address Address?

  user       User?     @relation(fields: [userId], references: [id])
  userId     Int?      @map("user_id")
  assignedAt DateTime? @map("assigned_at")

  shipment OrderShipment?
  items    OrderItem[]
  logs     OrderLog[]
  comments OrderComment[]
  payments OrderPayment[]

  // Accounting relations
  invoices           Invoice[]
  accountingPayments PaymentRecord[]
  codRemittanceItems CodRemittanceItem[]

  @@index([orderNumber])
  @@map("orders")
}

model OrderItem {
  id        Int     @id @default(autoincrement())
  name      String?
  unitPrice Float?  @map("unit_price")
  grams     Float?
  quantity  Float?
  discount  Float?
  sku       String?
  productId String? @map("product_id")
  variantId String? @map("variant_id")

  orderId Int   @map("order_id")
  order   Order @relation(fields: [orderId], references: [id])

  @@map("order_items")
}

model Address {
  id        Int     @id @default(autoincrement())
  address   String?
  note      String?
  city      String?
  phone     String?
  zip       Float?
  province  String?
  country   String?
  longitude Float?
  latitude  Float?

  orderId Int   @unique @map("order_id")
  order   Order @relation(fields: [orderId], references: [id])

  customerId Int      @map("customer_id")
  customer   Customer @relation(fields: [customerId], references: [id])

  @@map("order_addresses")
}

model Customer {
  id    Int     @id @default(autoincrement())
  name  String?
  email String?
  phone String @unique()

  orders    Order[]
  addresses Address[]
  invoices  Invoice[]

  @@map("customers")
}

model OrderPayment {
  id     Int     @id @default(autoincrement())
  type   String
  bank   String
  tId    String  @map("t_id")
  amount Float
  note   String?

  orderId Int   @map("order_id")
  order   Order @relation(fields: [orderId], references: [id])

  @@map("order_payments")
}

model OrderLog {
  id        Int      @id @default(autoincrement())
  event     String
  createdAt DateTime @default(now()) @map("created_at")

  userId Int?  @map("user_id")
  user   User? @relation(fields: [userId], references: [id])

  orderId Int   @map("order_id")
  order   Order @relation(fields: [orderId], references: [id])

  @@map("order_logs")
}

model OrderComment {
  id        Int      @id @default(autoincrement())
  comment   String
  createdAt DateTime @default(now()) @map("created_at")

  userId Int?  @map("user_id")
  user   User? @relation(fields: [userId], references: [id])

  orderId Int   @map("order_id")
  order   Order @relation(fields: [orderId], references: [id])

  @@map("order_comments")
}

model ShopifyWebhookLog {
  id           String    @id @default(uuid())
  webhookId    String    @map("webhook_id")
  eventId      String    @map("event_id")
  identifier   String?
  domain       String
  topic        String
  apiVersion   String    @map("api_version")
  triggeredAt  DateTime  @map("triggered_at")
  receivedAt   DateTime  @map("received_at")
  processedAt  DateTime? @map("processed_at")
  status       String    @default("received")
  error        String?
  payload      Json
  retries      Int       @default(0)
  itemQuantity Int?      @map("item_quantity")
  amount       Float?

  @@map("shopify_webhook_logs")
}

model Channel {
  id     Int     @id @default(autoincrement())
  name   String
  type   String?
  source String?
  active Boolean @default(true)

  brandId Int?   @map("brand_id")
  brand   Brand? @relation(fields: [brandId], references: [id])

  orders Order[]

  @@map("channels")
}

model Brand {
  id     Int     @id @default(autoincrement())
  name   String
  active Boolean @default(true)

  channels Channel[]
  orders   Order[]
  category Category[]
  products Product[]

  @@map("brands")
}

model Category {
  id          Int     @id @default(autoincrement())
  name        String
  description String?

  brandId  Int?      @map("brand_id")
  brand    Brand?    @relation(fields: [brandId], references: [id])
  products Product[]

  @@map("categories")
}

model UnitOfMeasure {
  id          Int     @id @default(autoincrement())
  name        String
  description String?

  @@map("unit_of_measures")
}

model Product {
  id          Int     @id @default(autoincrement())
  name        String
  description String?
  sku         String  @unique
  barcode     String?
  unitPrice   Int     @map("unit_price")
  costPrice   Int?    @map("cost_price")
  incentive   Int?
  weight      Int?
  active      Boolean @default(true)
  unit        String?

  categoryId Int?      @map("category_id")
  category   Category? @relation(fields: [categoryId], references: [id])

  brandId Int?   @map("brand_id")
  brand   Brand? @relation(fields: [brandId], references: [id])

  variants ProductVariant[]

  // Accounting relations
  invoiceItems InvoiceItem[]

  @@map("products")
}

model ProductAttribute {
  id          Int     @id @default(autoincrement())
  name        String  @unique
  description String?

  values ProductAttributeValue[]

  @@map("product_attributes")
}

model ProductAttributeValue {
  id    Int    @id @default(autoincrement())
  value String

  attributeId Int              @map("attribute_id")
  attribute   ProductAttribute @relation(fields: [attributeId], references: [id], onDelete: Cascade)

  variantAttributes ProductVariantAttribute[]

  @@unique([attributeId, value])
  @@map("product_attribute_values")
}

model ProductVariant {
  id        Int     @id @default(autoincrement())
  sku       String  @unique
  barcode   String?
  unitPrice Int?    @map("unit_price")
  costPrice Int?    @map("cost_price")
  active    Boolean @default(true)

  productId Int     @map("product_id")
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  attributes ProductVariantAttribute[]

  // Inventory relations
  inventoryItems     InventoryItem[]
  purchaseOrderItems PurchaseOrderItem[]
  stockTransferItems StockTransferItem[]

  @@map("product_variants")
}

model ProductVariantAttribute {
  id Int @id @default(autoincrement())

  variantId Int            @map("variant_id")
  variant   ProductVariant @relation(fields: [variantId], references: [id], onDelete: Cascade)

  attributeValueId Int                   @map("attribute_value_id")
  attributeValue   ProductAttributeValue @relation(fields: [attributeValueId], references: [id])

  @@unique([variantId, attributeValueId])
  @@map("product_variant_attributes")
}
